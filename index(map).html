<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Imus City Map</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <!-- Custom Styles -->
    <style>
      #map {
        height: 600px;
        width: 100%;
      }

      h1 {
        color: white;
        margin-left: 4%;
        font-size: bold;
        font-weight: 20px;
      }

      body {
        background-color: rgb(17, 133, 50);

      }  
    

      .search-container {
        margin: 10px auto;
        width: 80%;
        max-width: 600px;
        background-color: #d3d3d3;
        padding: 20px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      }

      #search-input {
        flex: 1;
        padding: 10px;
        margin-right: 10px;
        font-size: 16px;
      }

      #search-button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: cyan;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        font-weight: bold;
      }

      .back-button {
        position: absolute;
        top: 20px;
        right: 30px;
        color: white;
        background-color: rgb(1, 11, 113);
        border: none;
        padding: 10px 25px;
        border-radius: 5px;
        font-size: 20px;
        cursor: pointer;
        z-index: 1000;
        font-weight: bold;
      }
    </style>
</head>
<body>

  <h1>Interactive Imus City Map with Historical Places</h1>

  <button class="back-button" onclick="window.history.back();">Back</button>

  <!-- Search Box -->
  <div class="search-container">
    <input type="text" id="search-input" placeholder="Enter a place" />
    <button id="search-button">Search</button>
  </div>

  <div id="map"></div>

  <!-- Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="">
  </script>
    
  <!-- Custom Script -->
  <script>
      // Coordinates for Gen. Juan Castañeda Senior High School
      const schoolLat = 14.3822;  // 14°22'56"N
      const schoolLon = 120.9367; // 120°56'12"E

      // Initialize the map and set the view to Gen. Juan Castañeda Senior High School
      const map = L.map('map').setView([schoolLat, schoolLon], 16);  // Set zoom level to 16 for a closer view

      // Add ESRI basemap tiles
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      minZoom: 12, // Limit the minimum zoom level to keep focus
    }).addTo(map);

      // Add marker and pop-up for Gen. Juan Castañeda Senior High School
      L.marker([schoolLat, schoolLon]).addTo(map)
        .bindPopup('You are currently here')
        .openPopup();  // Open the pop-up automatically

      // Add markers with pop-ups for each historical place
      const historicalPlaces = [
        {
            name: 'Imus Cathedral',
            lat: 14.4222,
            lon: 120.9369,
            trivia: 'Imus Cathedral is a historic church where important religious ceremonies in Cavite have taken place. It played a key role in the Philippine revolution.'
        },
        {
            name: 'Battle of Imus Monument',
            lat: 14.4313,
            lon: 120.9345,
            trivia: 'This monument commemorates the Battle of Imus, an important victory for Filipino revolutionaries against the Spanish in 1896.'
        },
        {
            name: 'Battle of Alapan Marker',
            lat: 14.4347,
            lon: 120.9392,
            trivia: 'The Battle of Alapan is considered the first military victory of Emilio Aguinaldo during the revolution, leading to the first raising of the Philippine flag.'
        },
        {
            name: 'Imus Plaza',
            lat: 14.4295,
            lon: 120.9367,
            trivia: 'Imus Plaza has historical significance as a gathering place for political meetings and cultural events during the colonial period.'
        },
        {
            name: 'House of Tirona',
            lat: 14.4350,
            lon: 120.9361,
            trivia: 'The House of Tirona is the ancestral home of General Daniel Tirona, a prominent figure during the Philippine revolution.'
        }
      ];

      historicalPlaces.forEach(place => {
        L.marker([place.lat, place.lon]).addTo(map)
            .bindPopup(` 
                <div>
                    <b>${place.name}</b><br>
                    ${place.trivia}
                </div>
            `);

        // Add text label (tooltip) on the map for each historical place
        L.tooltip({
          permanent: true, // Always show the tooltip
          direction: 'top', // Position the tooltip above the marker
          className: 'text-label' // Custom class for styling
        })
        .setContent(place.name)
        .setLatLng([place.lat, place.lon])
        .addTo(map);
      });
      
      // Search functionality (unchanged)
      document.getElementById('search-button').addEventListener('click', function() {
          const query = document.getElementById('search-input').value;
          if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(function(position) {
                  const currentLat = position.coords.latitude;
                  const currentLon = position.coords.longitude;

                  fetch(`https://nominatim.openstreetmap.org/search?q=${query}&format=json`)
                      .then(response => response.json())
                      .then(data => {
                          if (data.length > 0) {
                              const { lat, lon } = data[0];
                              map.setView([lat, lon], 16);  // Zoom level 16 for a closer view
                              L.marker([lat, lon]).addTo(map)
                                  .bindPopup(` 
                                      <b>${query}</b><br>
                                      Located here
                                  `);
                          } else {
                              alert('No results found.');
                          }
                      })
                      .catch(error => console.error('Error fetching geocoding data:', error));
              }, function(error) {
                  alert('Unable to retrieve your location.');
              });
          } else {
              alert('Geolocation is not supported by this browser.');
          }
      });
    </script>
</body>
</html>
